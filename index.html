<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DozedEnt - P2P Survival Game</title>
    <!-- Game Stylesheets -->
    <link rel="stylesheet" href="src/css/base.css">
    <link rel="stylesheet" href="src/css/game-viewport.css">
    <link rel="stylesheet" href="src/css/loading.css">
    <link rel="stylesheet" href="src/css/player.css">
    <link rel="stylesheet" href="src/css/combat.css">
    <link rel="stylesheet" href="src/css/enemies.css">
    <link rel="stylesheet" href="src/css/ambient.css">
    <link rel="stylesheet" href="src/css/world.css">
    <link rel="stylesheet" href="src/css/ui.css">
    <link rel="stylesheet" href="src/css/roguelike-hud.css">
    <link rel="stylesheet" href="src/css/combat-feedback.css">
    <link rel="stylesheet" href="src/css/mobile.css">
    <link rel="stylesheet" href="src/css/phases.css">
    <link rel="stylesheet" href="src/css/responsive.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading DozedEnt...</div>
        <div class="loading-text" style="font-size: 14px; margin-top: 10px;">Initializing WASM game engine</div>
        <button id="start-game-btn" disabled style="margin-top: 20px; padding: 12px 24px; background: #666; color: #fff; border: none; border-radius: 25px; font-size: 16px; cursor: not-allowed; transition: background 0.2s ease;">Loading...</button>
    </div>

    <!-- Main Game Viewport -->
    <div id="viewport">
        <!-- Game Canvas for Enhanced Rendering -->
        <canvas id="gameCanvas" width="1280" height="720"></canvas>

        <!-- Main Game Canvas -->
        <div id="canvas"></div>

        <!-- Game Boundary Overlay -->
        <div class="game-boundary"></div>
    </div>

    <!-- UI Overlays -->
    <div class="ui-overlay">
        <!-- Connection Status -->
        <div id="connectionStatus" class="status-connecting">Connecting...</div>
        
        <!-- Player Count -->
        <div id="playerCount">Players: 1</div>
        
        <!-- Debug HUD -->
        <div id="debug-hud"></div>
        
        <!-- Controls Tip (Desktop) -->
        <div id="controls-tip">
            WASD to move â€¢ J/K for attacks â€¢ L for special â€¢ Shift to block â€¢ Space/Ctrl to roll
        </div>
    </div>

    <!-- Mobile Controls -->
    <div class="mobile-controls">
        <!-- Joystick -->
        <div id="joystick">
            <div id="joystick-base">
                <div id="joystick-knob"></div>
            </div>
        </div>
        
        <!-- Enhanced Action Buttons (5-Button Combat System) -->
        <div id="actions">
            <button id="light-attack-btn" class="action-btn attack-btn" data-action="lightAttack">
                <div class="btn-icon">âš¡</div>
                <div class="btn-label">Light</div>
                <div class="btn-key">J</div>
            </button>
            <button id="heavy-attack-btn" class="action-btn attack-btn" data-action="heavyAttack">
                <div class="btn-icon">ğŸ’¥</div>
                <div class="btn-label">Heavy</div>
                <div class="btn-key">K</div>
            </button>
            <button id="block-btn" class="action-btn block-btn" data-action="block">
                <div class="btn-icon">ğŸ›¡ï¸</div>
                <div class="btn-label">Block</div>
                <div class="btn-key">Shift</div>
            </button>
            <button id="roll-btn" class="action-btn roll-btn" data-action="roll">
                <div class="btn-icon">ğŸŒ€</div>
                <div class="btn-label">Roll</div>
                <div class="btn-key">Space</div>
            </button>
            <button id="special-btn" class="action-btn special-btn" data-action="special">
                <div class="btn-icon">â­</div>
                <div class="btn-label">Special</div>
                <div class="btn-key">L</div>
            </button>
        </div>
    </div>

    <!-- Orientation Overlay (Mobile) -->
    <div id="orientation-overlay">
        <h2>ğŸ® DozedEnt</h2>
        <p>Please rotate your device to landscape mode for the best gaming experience.</p>
        <button id="overlay-start">Start Game</button>
    </div>

    <!-- Phase Overlays -->
    
    <!-- Choice Phase -->
    <div id="choice-overlay" class="phase-overlay hidden">
        <h2>ğŸ¯ Choose Your Path</h2>
        <p>Select one of three options to continue your journey. Each choice will affect your character's abilities and the challenges ahead.</p>
        <button id="choice-0" class="choice-button">Safe Choice</button>
        <button id="choice-1" class="choice-button">Spicy Choice</button>
        <button id="choice-2" class="choice-button">Weird Choice</button>
    </div>

    <!-- Risk Phase -->
    <div id="risk-overlay" class="phase-overlay hidden">
        <h2>ğŸ² Risk Phase</h2>
        <p>Push your luck! The riskier you are, the greater the rewards, but also the greater the danger.</p>
        
        <div class="risk-stats">
            <div class="risk-stat">
                <h3>Risk Multiplier</h3>
                <div id="risk-mult">1.0x</div>
            </div>
            <div class="risk-stat">
                <h3>Active Curses</h3>
                <ul id="curse-list"></ul>
            </div>
            <div class="risk-stat">
                <h3>Timed Challenge</h3>
                <div id="timed-challenge" class="hidden">
                    <div>Progress: <span id="challenge-progress">0</span>/<span id="challenge-target">0</span></div>
                    <div>Time: <span id="challenge-time">0.0</span>s</div>
                </div>
            </div>
        </div>
        
        <button class="phase-button" onclick="gameApp.wasmManager?.escapeRisk?.()">Escape Risk</button>
    </div>

    <!-- Escalate Phase -->
    <div id="escalate-overlay" class="phase-overlay hidden">
        <h2>ğŸ“ˆ Escalate Phase</h2>
        <p>The difficulty is ramping up! Enemies are getting stronger, faster, and more numerous.</p>
        
        <div class="escalate-stats">
            <div class="escalate-stat">
                <h3>Escalation Level</h3>
                <div id="escalation-lvl">0%</div>
            </div>
            <div class="escalate-stat">
                <h3>Enemy Speed</h3>
                <div id="enemy-speed">1.0x</div>
            </div>
            <div class="escalate-stat">
                <h3>Enemy Damage</h3>
                <div id="enemy-damage">1.0x</div>
            </div>
            <div class="escalate-stat">
                <h3>Spawn Rate</h3>
                <div id="spawn-rate">1.0x</div>
            </div>
        </div>
        
        <div id="miniboss-alert" class="hidden">
            <h3>âš ï¸ Miniboss Alert!</h3>
            <div class="miniboss-health">
                <div class="miniboss-health-fill" style="width: 100%; height: 10px; background: #ff0000;"></div>
            </div>
        </div>
    </div>

    <!-- CashOut Phase -->
    <div id="cashout-overlay" class="phase-overlay hidden">
        <h2>ğŸ’° Shop Phase</h2>
        <p>Spend your hard-earned currency on upgrades and healing.</p>
        
        <div class="currency-display">
            <div class="currency">
                <h3>ğŸ”¶ Gold</h3>
                <div id="gold-amount">0</div>
            </div>
            <div class="currency">
                <h3>ğŸ”· Essence</h3>
                <div id="essence-amount">0</div>
            </div>
        </div>
        
        <div class="shop-items" id="shop-items">
            <!-- Shop items will be populated dynamically -->
        </div>
        
        <button class="phase-button" onclick="gameApp.wasmManager?.buyHeal?.()">Buy Full Heal (50ğŸ”¶ + 5ğŸ”·)</button>
        <button class="phase-button" onclick="gameApp.wasmManager?.rerollShopItems?.()">Reroll Shop (20ğŸ”¶)</button>
        <button class="phase-button" onclick="gameApp.wasmManager?.exitCashout?.()">Continue</button>
    </div>

    <!-- Game Over Overlay -->
    <div id="gameOverOverlay" class="phase-overlay hidden">
        <h2>ğŸ’€ Game Over</h2>
        <p>Your journey has ended. Will you try again?</p>
        <button id="restart-button">Restart Run</button>
        <button id="rematch-button">New Run</button>
    </div>

    <!-- Load the main game script -->
    <script type="module" src="site.js"></script>
</body>
</html>