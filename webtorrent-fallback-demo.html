<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebTorrent Fallback Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .demo-section {
            background-color: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success { background-color: #2d5a2d; }
        .status.error { background-color: #5a2d2d; }
        .status.warning { background-color: #5a4d2d; }
        .status.info { background-color: #2d4d5a; }
        button {
            background-color: #4a4a4a;
            color: white;
            border: 1px solid #666;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #5a5a5a;
        }
        .log {
            background-color: #1a1a1a;
            border: 1px solid #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }
        .alert {
            background-color: #3a3a3a;
            border: 1px solid #666;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }
        .alert.show {
            display: block;
        }
        .alert.warning {
            border-left: 4px solid #ffa500;
        }
        .alert-actions {
            margin-top: 10px;
        }
        .alert-actions button {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>üåê WebTorrent Fallback Demo</h1>
    
    <div class="demo-section">
        <h2>üéØ Problem</h2>
        <p>Firefox cannot connect to WebTorrent trackers:</p>
        <ul>
            <li><code>wss://tracker.webtorrent.dev/</code></li>
            <li><code>wss://tracker.files.fm:7073/announce</code></li>
        </ul>
        <p>This causes connection errors and prevents multiplayer functionality.</p>
    </div>

    <div class="demo-section">
        <h2>‚úÖ Solution</h2>
        <p>The game now automatically:</p>
        <ul>
            <li>Detects WebTorrent tracker failures</li>
            <li>Shows user-friendly error messages</li>
            <li>Switches to alternative network providers</li>
            <li>Continues gameplay in offline mode if needed</li>
        </ul>
    </div>

    <div class="demo-section">
        <h2>üß™ Test the Solution</h2>
        <div id="status" class="status info">Ready to test</div>
        <button onclick="simulateError()">Simulate WebTorrent Error</button>
        <button onclick="testFallback()">Test Fallback System</button>
        <button onclick="clearLog()">Clear Log</button>
        
        <div id="log" class="log">Demo log will appear here...</div>
    </div>

    <!-- Alert notification (simulated) -->
    <div id="alert" class="alert warning">
        <h3>‚ö†Ô∏è WebTorrent Tracker Unavailable</h3>
        <p>Cannot connect to tracker: <code>wss://tracker.webtorrent.dev/</code></p>
        <p>This may be due to network restrictions or tracker downtime.</p>
        <div class="alert-actions">
            <button onclick="tryAlternativeProvider()">Try Alternative Provider</button>
            <button onclick="continueOffline()">Continue Offline</button>
            <button onclick="dismissAlert()">Dismiss</button>
        </div>
    </div>

    <script>
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = 'Demo log cleared...\n';
        }

        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function simulateError() {
            log('üé≠ Simulating WebTorrent tracker failure...');
            log('‚ùå Connection error: wss://tracker.webtorrent.dev/ - Connection refused');
            
            // Show the alert notification
            document.getElementById('alert').classList.add('show');
            
            updateStatus('WebTorrent error detected - showing user notification', 'warning');
            log('üì¢ User notification displayed with fallback options');
        }

        function tryAlternativeProvider() {
            log('üîÑ User selected: Try Alternative Provider');
            log('üîß Switching to MQTT provider...');
            
            setTimeout(() => {
                log('‚úÖ Successfully connected to MQTT provider');
                log('üéÆ Multiplayer functionality restored');
                updateStatus('Connected via MQTT provider', 'success');
                dismissAlert();
            }, 1000);
        }

        function continueOffline() {
            log('üîÑ User selected: Continue Offline');
            log('üéÆ Switching to offline mode...');
            log('‚úÖ Game continues in single-player mode');
            updateStatus('Running in offline mode', 'info');
            dismissAlert();
        }

        function dismissAlert() {
            document.getElementById('alert').classList.remove('show');
            log('üì± Alert dismissed by user');
        }

        function testFallback() {
            log('üß™ Testing automatic fallback system...');
            
            // Simulate the automatic recovery process
            const providers = ['torrent', 'mqtt', 'firebase', 'ipfs'];
            let currentProvider = 0;
            
            const tryNextProvider = () => {
                if (currentProvider < providers.length) {
                    const provider = providers[currentProvider];
                    log(`üîÑ Trying provider: ${provider}`);
                    
                    setTimeout(() => {
                        if (provider === 'torrent') {
                            log(`‚ùå ${provider} failed - WebTorrent tracker unavailable`);
                        } else {
                            log(`‚úÖ ${provider} connected successfully`);
                            updateStatus(`Connected via ${provider.toUpperCase()}`, 'success');
                            return;
                        }
                        
                        currentProvider++;
                        tryNextProvider();
                    }, 500);
                } else {
                    log('‚ùå All providers failed - entering offline mode');
                    updateStatus('All providers failed - offline mode', 'error');
                }
            };
            
            tryNextProvider();
        }

        // Initialize demo
        log('üöÄ WebTorrent Fallback Demo initialized');
        log('üí° Click "Simulate WebTorrent Error" to see the solution in action');
    </script>
</body>
</html>
