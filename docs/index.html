<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="author" content="Dan Motzenbecker">
    <meta name="description" content="Serverless WebRTC matchmaking for painless P2P mobile game">
    <title>Dozed Ent - Mobile Game with WebRTC</title>
    <link href="images/favicon.png" rel="icon" type="image/png">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital@0;1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="site.css">
</head>
<body>
    <div class="game-container">
        <!-- Top HUD -->
        <div class="top-hud">
            <div class="player-info">
                <div class="health-bar">
                    <div class="health-fill"></div>
                    <span class="health-text">100/100</span>
                </div>
                <div class="energy-bar">
                    <div class="energy-fill"></div>
                    <span class="energy-text">50/50</span>
                </div>
            </div>
            <div class="score-info">
                <span class="score">Score: 0</span>
                <span class="level">Lv. 1</span>
            </div>
        </div>

        <!-- Connection Status (from docs/index.html) -->
        <div id="status">
            <div id="peer-count">Players: 1</div>
            <div id="connection-status">Connecting...</div>
        </div>

        <!-- Lobby Panel (Hidden by default) -->
        <div class="lobby-panel" id="lobbyPanel" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.95); border: 2px solid #4a90e2; border-radius: 10px; padding: 20px; z-index: 1000; min-width: 400px; max-width: 600px;">
            <div class="lobby-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #4a90e2; margin: 0;">üéÆ Game Lobby</h3>
                <button class="close-btn" onclick="toggleLobby()" style="background: none; border: none; color: #fff; font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            <div class="lobby-content">
                <div class="lobby-tabs" style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="tab-btn active" onclick="showLobbyTab('rooms')" style="padding: 8px 16px; background: #4a90e2; border: none; color: white; border-radius: 5px; cursor: pointer;">Rooms</button>
                    <button class="tab-btn" onclick="showLobbyTab('create')" style="padding: 8px 16px; background: #333; border: none; color: white; border-radius: 5px; cursor: pointer;">Create</button>
                    <button class="tab-btn" onclick="showLobbyTab('quick')" style="padding: 8px 16px; background: #333; border: none; color: white; border-radius: 5px; cursor: pointer;">Quick Play</button>
                </div>
                <div class="tab-content" id="roomsTab">
                    <div id="roomsList" style="color: #fff; max-height: 300px; overflow-y: auto;">Loading rooms...</div>
                </div>
                <div class="tab-content" id="createTab" style="display: none;">
                    <input type="text" id="roomName" placeholder="Room Name" style="width: 100%; padding: 8px; margin-bottom: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 5px;" />
                    <select id="gameMode" style="width: 100%; padding: 8px; margin-bottom: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 5px;">
                        <option value="default">Default</option>
                        <option value="deathmatch">Deathmatch</option>
                        <option value="team">Team Battle</option>
                        <option value="survival">Survival</option>
                    </select>
                    <button onclick="createRoom()" style="width: 100%; padding: 10px; background: #4a90e2; border: none; color: white; border-radius: 5px; cursor: pointer;">Create Room</button>
                </div>
                <div class="tab-content" id="quickTab" style="display: none;">
                    <button onclick="quickPlay()" style="width: 100%; padding: 20px; background: #4a90e2; border: none; color: white; border-radius: 5px; cursor: pointer; font-size: 18px;">üéØ Find Match</button>
                </div>
                <div class="chat-section" id="lobbyChat" style="margin-top: 20px;">
                    <div id="chatMessages" style="height: 150px; overflow-y: auto; border: 1px solid #333; padding: 10px; background: #1a1a1a; color: #fff; border-radius: 5px; margin-bottom: 10px;"></div>
                    <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter')sendChat()" style="width: 100%; padding: 8px; background: #333; border: 1px solid #555; color: white; border-radius: 5px;" />
                </div>
            </div>
        </div>

        <!-- Settings Panel (Hidden by default) -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3>Settings</h3>
                <button class="close-btn" onclick="toggleSettings()">√ó</button>
            </div>
            <div class="settings-content">
                <div class="setting-item">
                    <label>Sound</label>
                    <input type="range" min="0" max="100" value="50">
                </div>
                <div class="setting-item">
                    <label>Vibration</label>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Control Size</label>
                    <select>
                        <option>Small</option>
                        <option selected>Medium</option>
                        <option>Large</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Game Viewport Container -->
        <div id="viewport" class="viewport-container">
            <!-- Game Canvas Area with markers support -->
            <div id="canvas" role="region" aria-label="Game area">
                <!-- Markers are injected dynamically: .marker.landmark / .marker.exit / .marker.obstacle -->
            </div>
        </div>
        <canvas id="gameCanvas"></canvas>

        <!-- Desktop controls tooltip -->
        <div id="controls-tip" hidden>
            <div>Controls</div>
            <ul>
                <li>Move: WASD / Arrows</li>
                <li>Roll: K</li>
                <li>Attack: L</li>
                <li>Block: M</li>
            </ul>
        </div>

        <!-- Mobile Controls -->
        <div class="mobile-controls">
            <!-- Left Side: Settings Button -->
            <div class="left-controls">
                <!-- Settings Button -->
                <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
                <!-- Lobby Button -->
                <button class="lobby-btn" onclick="toggleLobby()" style="margin-left: 10px;">üè†</button>
            </div>

            <!-- Right Side: Action Buttons -->
            <div class="right-controls">
                <!-- Main Action Buttons -->
                <div class="action-buttons">
                    <button class="action-btn primary" data-action="attack">
                        <span class="btn-icon">‚öîÔ∏è</span>
                        <span class="cooldown"></span>
                    </button>
                    <button class="action-btn secondary" data-action="roll">
                        <span class="btn-icon">üåÄ</span>
                        <span class="cooldown"></span>
                    </button>
                    <button class="action-btn tertiary" data-action="block">
                        <span class="btn-icon">üõ°Ô∏è</span>
                        <span class="cooldown"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile joystick (from docs/index.html) -->
        <div id="joystick">
            <div id="joystick-base">
                <div id="joystick-knob"></div>
            </div>
        </div>



        <!-- Mini Map -->
        <div class="minimap">
            <div class="map-container">
                <div class="player-position"></div>
            </div>
        </div>

        <!-- Orientation / fullscreen overlay for mobile (from docs/index.html) -->
        <div id="orientation-overlay" hidden>
            <div class="overlay-box">
                <p class="overlay-title">Rotate your device</p>
                <p class="overlay-msg">For the best experience, play in landscape.</p>
                <button id="overlay-start" type="button">Tap to start</button>
            </div>
        </div>

        <!-- Choice overlay (from docs/index.html) -->
        <div id="choice-overlay" hidden>
            <div class="overlay-box">
                <p class="overlay-title">Choose your boon</p>
                <div class="choices">
                    <button id="choice-0" type="button">Option A</button>
                    <button id="choice-1" type="button">Option B</button>
                    <button id="choice-2" type="button">Option C</button>
                </div>
                <button id="restart-button" type="button">Restart (R)</button>
            </div>
        </div>

        <!-- Game Over overlay (from docs/index.html) -->
        <div id="gameover-overlay" hidden>
            <div class="overlay-box">
                <p class="overlay-title">Game Over</p>
                <p class="overlay-msg">You were taken down by the pack.</p>
                <button id="rematch-button" type="button">Rematch</button>
            </div>
        </div>

        <!-- Risk Phase overlay -->
        <div id="risk-overlay" hidden>
            <div class="overlay-box risk-phase">
                <p class="overlay-title">‚ö†Ô∏è RISK PHASE</p>
                <div class="risk-info">
                    <div class="risk-multiplier">Risk Multiplier: <span id="risk-mult">1.0x</span></div>
                    <div class="active-curses">
                        <p>Active Curses:</p>
                        <ul id="curse-list"></ul>
                    </div>
                    <div class="timed-challenge" id="timed-challenge" hidden>
                        <p>Challenge: <span id="challenge-progress">0</span>/<span id="challenge-target">5</span></p>
                        <p>Time: <span id="challenge-time">0</span>s</p>
                    </div>
                </div>
                <button id="escape-risk-button" type="button">Escape (Cost: Stamina)</button>
            </div>
        </div>

        <!-- Escalate Phase overlay -->
        <div id="escalate-overlay" hidden>
            <div class="overlay-box escalate-phase">
                <p class="overlay-title">üìà ESCALATION</p>
                <div class="escalate-info">
                    <div class="escalation-level">Level: <span id="escalation-lvl">0%</span></div>
                    <div class="modifiers">
                        <p>Enemy Modifiers:</p>
                        <div class="modifier-list">
                            <span class="modifier-stat">Speed: <span id="enemy-speed">1.0x</span></span>
                            <span class="modifier-stat">Damage: <span id="enemy-damage">1.0x</span></span>
                            <span class="modifier-stat">Spawn Rate: <span id="spawn-rate">1.0x</span></span>
                        </div>
                    </div>
                    <div class="miniboss-alert" id="miniboss-alert" hidden>
                        <p>‚öîÔ∏è MINIBOSS ACTIVE!</p>
                        <div class="miniboss-health">
                            <div class="miniboss-health-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CashOut Phase overlay -->
        <div id="cashout-overlay" hidden>
            <div class="overlay-box cashout-phase">
                <p class="overlay-title">üí∞ SHOP</p>
                <div class="currency-display">
                    <span class="gold">üî∂ Gold: <span id="gold-amount">0</span></span>
                    <span class="essence">üî∑ Essence: <span id="essence-amount">0</span></span>
                </div>
                <div class="shop-items" id="shop-items">
                    <!-- Shop items will be populated dynamically -->
                </div>
                <div class="shop-actions">
                    <button id="heal-button" type="button">Heal (50üî∂ 5üî∑)</button>
                    <button id="reroll-button" type="button">Reroll Shop (20üî∂)</button>
                    <button id="exit-shop-button" type="button">Leave Shop</button>
                </div>
                <div class="forge-section">
                    <p>‚öíÔ∏è Forge</p>
                    <div class="forge-options" id="forge-options">
                        <button class="forge-btn" data-forge="0">Sharpen (30üî∂)</button>
                        <button class="forge-btn" data-forge="1">Reinforce (25üî∂)</button>
                        <button class="forge-btn" data-forge="2">Enchant (50üî∂ 8üî∑)</button>
                        <button class="forge-btn" data-forge="3">Reroll (40üî∂ 5üî∑)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="controls.js"></script>
    <script src="site.js" type="module"></script>
</body>
</html>