<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>DozedEnt - P2P Survival Game</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Game Stylesheets -->
    <link rel="stylesheet" href="js/src/css/base.css">
    <link rel="stylesheet" href="js/src/css/game-viewport.css">
    <link rel="stylesheet" href="js/src/css/loading.css">
    <link rel="stylesheet" href="js/src/css/player.css">
    <link rel="stylesheet" href="js/src/css/combat.css">
    <link rel="stylesheet" href="js/src/css/enemies.css">
    <link rel="stylesheet" href="js/src/css/ambient.css">
    <link rel="stylesheet" href="js/src/css/world.css">
    <link rel="stylesheet" href="js/src/css/ui.css">
    <link rel="stylesheet" href="js/src/css/roguelike-hud.css">
    <link rel="stylesheet" href="js/src/css/mobile.css">
    <link rel="stylesheet" href="js/src/css/phases.css">
    <link rel="stylesheet" href="js/src/css/responsive.css">
    
    <!-- Enhanced UI System Stylesheets -->
    <link rel="stylesheet" href="js/src/css/death-feedback-system.css">
    <link rel="stylesheet" href="js/src/css/combat-ui-optimizer.css">
    <link rel="stylesheet" href="js/src/css/threat-awareness-ui.css">
    <link rel="stylesheet" href="js/src/css/comprehensive-accessibility.css">
    <link rel="stylesheet" href="js/src/css/modern-roguelite-ui.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading DozedEnt...</div>
        <div class="loading-text" style="font-size: 14px; margin-top: 10px;">Initializing WASM game engine</div>
        <button id="start-game-btn" disabled style="margin-top: 20px; padding: 12px 24px; background: #666; color: #fff; border: none; border-radius: 25px; font-size: 16px; cursor: not-allowed; transition: background 0.2s ease;">Loading...</button>
    </div>

    <!-- Main Game Viewport -->
    <div id="viewport">
        <!-- Game Canvas for Enhanced Rendering -->
        <canvas id="gameCanvas" width="1280" height="720"></canvas>

        <!-- Main Game Canvas -->
        <div id="canvas"></div>

        <!-- Game Boundary Overlay -->
        <div class="game-boundary"></div>
    </div>

    <!-- UI Overlays -->
    <div class="ui-overlay">
        <!-- Connection Status -->
        <div id="connectionStatus" class="status-connecting">Connecting...</div>
        
        <!-- Player Count -->
        <div id="playerCount">Players: 1</div>
        
        <!-- Debug HUD -->
        <div id="debug-hud"></div>
    </div>

    <!-- Modern Roguelite UI Container -->
    <div id="modern-roguelite-ui" class="modern-roguelite-ui">
        <!-- This will be populated by the ModernRogueliteUI class -->
    </div>

    <!-- Interface Switcher -->
    <button id="interface-switcher" class="interface-switcher" title="Switch Interface">ğŸ”„</button>
    
    <!-- Enhanced UI Toggle -->
    <button id="enhanced-ui-toggle" class="enhanced-ui-toggle" title="Toggle Enhanced UI">âš¡</button>

    <!-- Mobile Controls -->
    <div class="mobile-controls" id="mobile-controls">
        <!-- Joystick -->
        <div id="joystick">
            <div id="joystick-base">
                <div id="joystick-knob"></div>
            </div>
        </div>
        
        <!-- Center Spacer for Interface 1 -->
        <div class="center-spacer">
            <div class="quick-stats">
                <div class="stat">
                    <div class="stat-value" id="health-stat">100</div>
                    <div>Health</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="score-stat">0</div>
                    <div>Score</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="level-stat">1</div>
                    <div>Level</div>
                </div>
            </div>
        </div>
        
        <!-- Enhanced Action Buttons (5-Button Combat System) -->
        <div id="actions">
            <button id="light-attack-btn" class="action-btn attack-btn" data-action="lightAttack">
                <div class="btn-icon">âš¡</div>
                <div class="btn-label">Light</div>
                <div class="btn-key">J</div>
            </button>
            <button id="heavy-attack-btn" class="action-btn attack-btn" data-action="heavyAttack">
                <div class="btn-icon">ğŸ’¥</div>
                <div class="btn-label">Heavy</div>
                <div class="btn-key">K</div>
            </button>
            <button id="block-btn" class="action-btn block-btn" data-action="block">
                <div class="btn-icon">ğŸ›¡ï¸</div>
                <div class="btn-label">Block</div>
                <div class="btn-key">Shift</div>
            </button>
            <button id="roll-btn" class="action-btn roll-btn" data-action="roll">
                <div class="btn-icon">ğŸŒ€</div>
                <div class="btn-label">Roll</div>
                <div class="btn-key">Space</div>
            </button>
            <button id="special-btn" class="action-btn special-btn" data-action="special">
                <div class="btn-icon">â­</div>
                <div class="btn-label">Special</div>
                <div class="btn-key">L</div>
            </button>
        </div>
    </div>

    <!-- Mobile UI Panels -->
    <!-- Status Effects Panel -->
    <div class="status-effects-mobile" id="status-effects-mobile">
        <div class="panel-title">Status Effects</div>
        <div class="status-effect-item">
            <div class="effect-icon-small">â¤ï¸</div>
            <div class="effect-name-small">Health</div>
            <div class="effect-duration-small" id="health-value">100</div>
        </div>
        <div class="status-effect-item">
            <div class="effect-icon-small">âš¡</div>
            <div class="effect-name-small">Energy</div>
            <div class="effect-duration-small" id="energy-value">100</div>
        </div>
    </div>

    <!-- Resources Panel -->
    <div class="resources-panel-mobile" id="resources-panel-mobile">
        <div class="panel-title">Resources</div>
        <div class="resource-row">
            <div class="resource-icon">ğŸ›¡ï¸</div>
            <div class="resource-label">Gold</div>
            <div class="resource-value" id="gold-value">0</div>
        </div>
        <div class="resource-row">
            <div class="resource-icon">ğŸŒ€</div>
            <div class="resource-label">Essence</div>
            <div class="resource-value" id="essence-value">0</div>
        </div>
    </div>

    <!-- Vitals Panel -->
    <div class="vitals-mobile" id="vitals-mobile">
        <div class="vital-bar-mobile">
            <div class="vital-icon-mobile">â¤ï¸</div>
            <div class="vital-progress-mobile">
                <div class="vital-fill-mobile health-fill-mobile" id="health-bar-mobile" style="width: 100%;"></div>
                <div class="vital-text-mobile" id="health-text-mobile">100/100</div>
            </div>
        </div>
        <div class="vital-bar-mobile">
            <div class="vital-icon-mobile">âš¡</div>
            <div class="vital-progress-mobile">
                <div class="vital-fill-mobile stamina-fill-mobile" id="stamina-bar-mobile" style="width: 100%;"></div>
                <div class="vital-text-mobile" id="stamina-text-mobile">100/100</div>
            </div>
        </div>
    </div>

    <!-- Orientation Overlay (Mobile) -->
    <div id="orientation-overlay">
        <div class="overlay-content">
            <div class="rotation-icon">ğŸ“±</div>
            <h2>ğŸ® DozedEnt</h2>
            <p>Please rotate your device to landscape mode for the best gaming experience.</p>
            <button id="overlay-start">Start Game</button>
        </div>
    </div>

    <!-- Phase Overlays -->
    
    <!-- Choice Phase -->
    <div id="choice-overlay" class="phase-overlay hidden">
        <h2>ğŸ¯ Choose Your Path</h2>
        <p>Select one of three options to continue your journey. Each choice will affect your character's abilities and the challenges ahead.</p>
        <button id="choice-0" class="choice-button">Safe Choice</button>
        <button id="choice-1" class="choice-button">Spicy Choice</button>
        <button id="choice-2" class="choice-button">Weird Choice</button>
    </div>

    <!-- Risk Phase -->
    <div id="risk-overlay" class="phase-overlay hidden">
        <h2>ğŸ² Risk Phase</h2>
        <p>Push your luck! The riskier you are, the greater the rewards, but also the greater the danger.</p>
        
        <div class="risk-stats">
            <div class="risk-stat">
                <h3>Risk Multiplier</h3>
                <div id="risk-mult">1.0x</div>
            </div>
            <div class="risk-stat">
                <h3>Active Curses</h3>
                <ul id="curse-list"></ul>
            </div>
            <div class="risk-stat">
                <h3>Timed Challenge</h3>
                <div id="timed-challenge" class="hidden">
                    <div>Progress: <span id="challenge-progress">0</span>/<span id="challenge-target">0</span></div>
                    <div>Time: <span id="challenge-time">0.0</span>s</div>
                </div>
            </div>
        </div>
        
        <button class="phase-button" onclick="gameApp.wasmManager?.escapeRisk?.()">Escape Risk</button>
    </div>

    <!-- Escalate Phase -->
    <div id="escalate-overlay" class="phase-overlay hidden">
        <h2>ğŸ“ˆ Escalate Phase</h2>
        <p>The difficulty is ramping up! Enemies are getting stronger, faster, and more numerous.</p>
        
        <div class="escalate-stats">
            <div class="escalate-stat">
                <h3>Escalation Level</h3>
                <div id="escalation-lvl">0%</div>
            </div>
            <div class="escalate-stat">
                <h3>Enemy Speed</h3>
                <div id="enemy-speed">1.0x</div>
            </div>
            <div class="escalate-stat">
                <h3>Enemy Damage</h3>
                <div id="enemy-damage">1.0x</div>
            </div>
            <div class="escalate-stat">
                <h3>Spawn Rate</h3>
                <div id="spawn-rate">1.0x</div>
            </div>
        </div>
        
        <div id="miniboss-alert" class="hidden">
            <h3>âš ï¸ Miniboss Alert!</h3>
            <div class="miniboss-health">
                <div class="miniboss-health-fill" style="width: 100%; height: 10px; background: #ff0000;"></div>
            </div>
        </div>
    </div>

    <!-- CashOut Phase -->
    <div id="cashout-overlay" class="phase-overlay hidden">
        <h2>ğŸ’° Shop Phase</h2>
        <p>Spend your hard-earned currency on upgrades and healing.</p>
        
        <div class="currency-display">
            <div class="currency">
                <h3>ğŸ”¶ Gold</h3>
                <div id="gold-amount">0</div>
            </div>
            <div class="currency">
                <h3>ğŸ”· Essence</h3>
                <div id="essence-amount">0</div>
            </div>
        </div>
        
        <div class="shop-items" id="shop-items">
            <!-- Shop items will be populated dynamically -->
        </div>
        
        <button class="phase-button" onclick="gameApp.wasmManager?.buyHeal?.()">Buy Full Heal (50ğŸ”¶ + 5ğŸ”·)</button>
        <button class="phase-button" onclick="gameApp.wasmManager?.rerollShopItems?.()">Reroll Shop (20ğŸ”¶)</button>
        <button class="phase-button" onclick="gameApp.wasmManager?.exitCashout?.()">Continue</button>
    </div>

    <!-- Game Over Overlay -->
    <div id="gameOverOverlay" class="phase-overlay hidden">
        <h2>ğŸ’€ Game Over</h2>
        <p>Your journey has ended. Will you try again?</p>
        <button id="restart-button">Restart Run</button>
        <button id="rematch-button">New Run</button>
    </div>

    <!-- Chat System (for multiplayer) -->
    <div id="chat-container" class="chat-container hidden">
        <div id="chat-messages" class="chat-messages"></div>
        <div class="chat-input-container">
            <input type="text" id="chatInput" placeholder="Type a message..." maxlength="100">
            <button id="chat-send-btn">Send</button>
        </div>
    </div>

    <!-- Tab System -->
    <div id="tab-container" class="tab-container hidden">
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="lobby">Lobby</button>
            <button class="tab-btn" data-tab="settings">Settings</button>
            <button class="tab-btn" data-tab="stats">Stats</button>
        </div>
        <div class="tab-contents">
            <div id="lobbyTab" class="tab-content">
                <h3>Game Lobby</h3>
                <p>Waiting for players...</p>
            </div>
            <div id="settingsTab" class="tab-content" style="display: none;">
                <h3>Settings</h3>
                <p>Game settings will appear here.</p>
            </div>
            <div id="statsTab" class="tab-content" style="display: none;">
                <h3>Statistics</h3>
                <p>Player statistics will appear here.</p>
            </div>
        </div>
    </div>

    <!-- Load the main game script -->
    <script type="module" src="js/site.js"></script>
</body>
</html>