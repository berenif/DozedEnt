<!DOCTYPE html>
<html>
<head>
    <title>WASM Loading Test</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>WASM Loading Test</h1>
    <div id="status">Testing WASM loading...</div>
    <div id="log" style="font-family: monospace; white-space: pre-wrap; background: #f0f0f0; padding: 10px; margin-top: 10px;"></div>
    
    <script type="module">
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function logMessage(message) {
            console.log(message);
            log.textContent += message + '\n';
        }
        
        async function testWasmLoading() {
            try {
                logMessage('üîç Starting WASM loading test...');
                
                // Test 1: Try to import the local WASM helper
                logMessage('1Ô∏è‚É£ Testing local WASM helper import...');
                let wasmHelperModule;
                try {
                    wasmHelperModule = await import('./dist/trystero-wasm.min.js');
                    logMessage('‚úÖ Local WASM helper imported successfully');
                    logMessage('üì¶ Module keys: ' + Object.keys(wasmHelperModule).join(', '));
                } catch (error) {
                    logMessage('‚ùå Local import failed: ' + error.message);
                    logMessage('üîÑ Trying CDN fallback...');
                    wasmHelperModule = await import('https://esm.run/trystero/wasm');
                    logMessage('‚úÖ CDN WASM helper imported successfully');
                    logMessage('üì¶ Module keys: ' + Object.keys(wasmHelperModule).join(', '));
                }
                
                // Test 2: Check if loadWasm function exists
                logMessage('2Ô∏è‚É£ Testing loadWasm function...');
                const {loadWasm} = wasmHelperModule;
                if (typeof loadWasm === 'function') {
                    logMessage('‚úÖ loadWasm function found');
                } else {
                    logMessage('‚ùå loadWasm function not found');
                    return;
                }
                
                // Test 3: Try to load the WASM file
                logMessage('3Ô∏è‚É£ Testing WASM file loading...');
                const {exports} = await loadWasm('./game.wasm');
                logMessage('‚úÖ WASM loaded successfully!');
                logMessage('üì¶ WASM exports: ' + Object.keys(exports).join(', '));
                
                // Test 4: Check for required functions
                logMessage('4Ô∏è‚É£ Testing required WASM functions...');
                if (typeof exports.start === 'function') {
                    logMessage('‚úÖ start() function exists');
                    try {
                        exports.start();
                        logMessage('‚úÖ start() function called successfully');
                    } catch (error) {
                        logMessage('‚ùå start() function failed: ' + error.message);
                    }
                } else {
                    logMessage('‚ùå start() function missing');
                }
                
                if (typeof exports.update === 'function') {
                    logMessage('‚úÖ update() function exists');
                } else {
                    logMessage('‚ùå update() function missing');
                }
                
                logMessage('üéâ All WASM tests completed successfully!');
                status.textContent = '‚úÖ WASM loading successful';
                status.style.color = 'green';
                
                // Make exports globally available for debugging
                window.testWasmExports = exports;
                logMessage('üîß WASM exports available as window.testWasmExports');
                
            } catch (error) {
                logMessage('üí• WASM loading failed: ' + error.name + ': ' + error.message);
                if (error.stack) {
                    logMessage('üìã Stack trace: ' + error.stack);
                }
                status.textContent = '‚ùå WASM loading failed';
                status.style.color = 'red';
            }
        }
        
        testWasmLoading();
    </script>
</body>
</html>