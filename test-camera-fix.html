<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Fix Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
        }
        .info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border: 1px solid #444;
            z-index: 1000;
        }
        .test-container {
            width: 1280px;
            height: 720px;
            margin: 50px auto;
            border: 2px solid #666;
            position: relative;
            overflow: hidden;
            background: #222;
        }
        .world {
            width: 3840px;
            height: 2160px;
            position: absolute;
            background: 
                repeating-linear-gradient(0deg, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 2px, transparent 2px, transparent 100px),
                repeating-linear-gradient(90deg, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 2px, transparent 2px, transparent 100px);
            transition: transform 0.1s ease-out;
        }
        .playable-area {
            position: absolute;
            left: 1280px;
            top: 720px;
            width: 1280px;
            height: 720px;
            border: 3px solid #0f0;
            background: rgba(0, 255, 0, 0.05);
        }
        .player {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #4a90e2;
            border: 2px solid #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        .coordinate-label {
            position: absolute;
            font-size: 10px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="info">
        <h3>Camera Fix Test</h3>
        <p>Player Position (WASM 0-1): <span id="wasmPos">0.5, 0.5</span></p>
        <p>Player Position (World): <span id="worldPos">1920, 1080</span></p>
        <p>Camera Position: <span id="cameraPos">640, 360</span></p>
        <p>Use Arrow Keys to move</p>
        <p style="color: #0f0;">Green border = Playable area (WASM 0-1 range mapped to center)</p>
    </div>

    <div class="test-container">
        <div class="world" id="world">
            <div class="playable-area"></div>
            <div class="player" id="player"></div>
            
            <!-- Coordinate labels -->
            <div class="coordinate-label" style="left: 5px; top: 5px;">(0, 0)</div>
            <div class="coordinate-label" style="right: 5px; top: 5px;">(3840, 0)</div>
            <div class="coordinate-label" style="left: 5px; bottom: 5px;">(0, 2160)</div>
            <div class="coordinate-label" style="right: 5px; bottom: 5px;">(3840, 2160)</div>
            
            <div class="coordinate-label" style="left: 1285px; top: 725px; color: #0f0;">Playable (1280, 720)</div>
            <div class="coordinate-label" style="left: 2545px; top: 725px; color: #0f0;">(2560, 720)</div>
            <div class="coordinate-label" style="left: 1285px; top: 1425px; color: #0f0;">(1280, 1440)</div>
            <div class="coordinate-label" style="left: 2545px; top: 1425px; color: #0f0;">(2560, 1440)</div>
        </div>
    </div>

    <script>
        // Simulated WASM position (0-1 range)
        let wasmX = 0.5;
        let wasmY = 0.5;
        
        // Camera position
        let cameraX = 0;
        let cameraY = 0;
        
        const WORLD_WIDTH = 3840;
        const WORLD_HEIGHT = 2160;
        const VIEWPORT_WIDTH = 1280;
        const VIEWPORT_HEIGHT = 720;
        const CAMERA_SMOOTHING = 0.1;
        
        function updatePosition() {
            // Scale WASM position to world coordinates (center third)
            const scaledX = 1.0 + wasmX;  // Maps 0-1 to 1-2
            const scaledY = 1.0 + wasmY;  // Maps 0-1 to 1-2
            const worldX = scaledX * (WORLD_WIDTH / 3);
            const worldY = scaledY * (WORLD_HEIGHT / 3);
            
            // Update player element
            const player = document.getElementById('player');
            player.style.left = worldX + 'px';
            player.style.top = worldY + 'px';
            
            // Update camera to follow player
            const targetCameraX = worldX - VIEWPORT_WIDTH / 2;
            const targetCameraY = worldY - VIEWPORT_HEIGHT / 2;
            
            // Clamp camera to world boundaries
            const clampedCameraX = Math.max(0, Math.min(targetCameraX, WORLD_WIDTH - VIEWPORT_WIDTH));
            const clampedCameraY = Math.max(0, Math.min(targetCameraY, WORLD_HEIGHT - VIEWPORT_HEIGHT));
            
            // Smooth camera movement
            cameraX += (clampedCameraX - cameraX) * CAMERA_SMOOTHING;
            cameraY += (clampedCameraY - cameraY) * CAMERA_SMOOTHING;
            
            // Apply camera transform
            const world = document.getElementById('world');
            world.style.transform = `translate(-${cameraX}px, -${cameraY}px)`;
            
            // Update info display
            document.getElementById('wasmPos').textContent = `${wasmX.toFixed(2)}, ${wasmY.toFixed(2)}`;
            document.getElementById('worldPos').textContent = `${Math.round(worldX)}, ${Math.round(worldY)}`;
            document.getElementById('cameraPos').textContent = `${Math.round(cameraX)}, ${Math.round(cameraY)}`;
        }
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            const speed = 0.02;
            switch(e.key) {
                case 'ArrowUp':
                    wasmY = Math.max(0, wasmY - speed);
                    break;
                case 'ArrowDown':
                    wasmY = Math.min(1, wasmY + speed);
                    break;
                case 'ArrowLeft':
                    wasmX = Math.max(0, wasmX - speed);
                    break;
                case 'ArrowRight':
                    wasmX = Math.min(1, wasmX + speed);
                    break;
            }
            updatePosition();
        });
        
        // Initial update
        updatePosition();
        
        // Animation loop for smooth camera
        function animate() {
            updatePosition();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>